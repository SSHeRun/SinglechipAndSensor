C51 COMPILER V9.01   DS18B20                                                               07/05/2016 15:59:06 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE DS18B20
OBJECT MODULE PLACED IN DS18B20.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE DS18B20.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /********************************************************************
   2          *该示例实现了用温度传感器件DS18B20对温度的采集，并在数码管上显示出来。
   3          ***********************************************************************/
   4          #include<reg52.h>
   5          #define uchar unsigned char
   6          #define uint  unsigned int
   7          
   8          #define jump_ROM 0xCC
   9          #define start 0x44
  10          #define read_EEROM 0xBE
  11          
  12          sbit DQ = P3^5;            //DS18B20数据口
  13          
  14          unsigned char TMPH,TMPL; 
  15          
  16          uchar code table[10] = {0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f};
  17          /********************************************************************
  18          * 名称 : delay()
  19          * 功能 : 延时,延时时间大概为140US。
  20          * 输入 : 无
  21          * 输出 : 无
  22          ***********************************************************************/
  23          
  24          void delay_1()
  25          {
  26   1              int i,j;
  27   1              for(i=0; i<=10; i++)
  28   1              for(j=0; j<=2; j++)
  29   1      ;
  30   1      }
  31          
  32          /********************************************************************
  33          * 名称 : delay()
  34          * 功能 : 延时函数
  35          * 输入 : 无
  36          * 输出 : 无
  37          ***********************************************************************/
  38          void delay(uint N)
  39          {
  40   1              int i;
  41   1              for(i=0; i<N; i++)
  42   1              ;
  43   1      }
  44          
  45          /********************************************************************
  46          * 名称 : Delay_1ms()
  47          * 功能 : 延时子程序，延时时间为 1ms * x
  48          * 输入 : x (延时一毫秒的个数)
  49          * 输出 : 无
  50          ***********************************************************************/
  51          void Delay_1ms(uint i)//1ms延时
  52          {
  53   1              uchar x,j;
  54   1              for(j=0;j<i;j++)
  55   1              for(x=0;x<=148;x++);    
C51 COMPILER V9.01   DS18B20                                                               07/05/2016 15:59:06 PAGE 2   

  56   1      }
  57          /********************************************************************
  58          * 名称 : Reset()
  59          * 功能 : 复位DS18B20
  60          * 输入 : 无
  61          * 输出 : 无
  62          ***********************************************************************/
  63          uchar Reset(void)
  64          {
  65   1              uchar deceive_ready;
  66   1              DQ = 0;
  67   1              delay(29);
  68   1              DQ = 1;
  69   1              delay(3);
  70   1              deceive_ready = DQ;
  71   1              delay(25);
  72   1              return(deceive_ready);
  73   1      }
  74          
  75          /********************************************************************
  76          * 名称 : read_bit()
  77          * 功能 : 从DS18B20读一个位值
  78          * 输入 : 无
  79          * 输出 : 从DS18B20读出的一个位值
  80          ***********************************************************************/
  81          uchar read_bit(void)
  82          {
  83   1              uchar i;
  84   1              DQ = 0;
  85   1              DQ = 1;
  86   1              for(i=0; i<3; i++);
  87   1              return(DQ);
  88   1      }
  89          
  90          /********************************************************************
  91          * 名称 : write_bit()
  92          * 功能 : 向DS18B20写一位
  93          * 输入 : bitval（要对DS18B20写入的位值）
  94          * 输出 : 无
  95          ***********************************************************************/
  96          void write_bit(uchar bitval)
  97          {
  98   1      DQ=0;if(bitval==1)
  99   1      DQ=1;
 100   1      delay(5);
 101   1      DQ=1;
 102   1      }
 103          
 104          /********************************************************************
 105          * 名称 : read_byte()
 106          * 功能 : 从DS18B20读一个字节
 107          * 输入 : 无
 108          * 输出 : 从DS18B20读到的值
 109          ***********************************************************************/
 110          uchar read_byte(void)
 111          {
 112   1              uchar i,m,receive_data;
 113   1              m = 1;
 114   1              receive_data = 0;
 115   1              for(i=0; i<8; i++)
 116   1              {
 117   2                      if(read_bit())
C51 COMPILER V9.01   DS18B20                                                               07/05/2016 15:59:06 PAGE 3   

 118   2                      {
 119   3                              receive_data = receive_data + (m << i);
 120   3                      }
 121   2                      delay(6);
 122   2              }
 123   1              return(receive_data);
 124   1      }
 125          
 126          /********************************************************************
 127          * 名称 : write_byte()
 128          * 功能 : 向DS18B20写一个字节
 129          * 输入 : val（要对DS18B20写入的命令值）
 130          * 输出 : 无
 131          ***********************************************************************/
 132          void write_byte(uchar val)
 133          {
 134   1              uchar i,temp;
 135   1              for(i=0; i<8; i++)
 136   1              {
 137   2                      temp = val >> i;
 138   2                      temp = temp & 0x01;
 139   2                      write_bit(temp);
 140   2                      delay(5);
 141   2              }
 142   1      }
 143          
 144          
 145          /********************************************************************
 146          * 名称 : Main()
 147          * 功能 : 主函数
 148          * 输入 : 无
 149          * 输出 : 无
 150          ***********************************************************************/
 151          void main()
 152          {
 153   1              //float tt;
 154   1              uint temp;
 155   1              P2 = 0x00;
 156   1              while(1)
 157   1              {
 158   2                      Reset();
 159   2                      write_byte(jump_ROM);
 160   2                      write_byte(start);
 161   2                      Reset();
 162   2                      write_byte(jump_ROM);
 163   2                      write_byte(read_EEROM);
 164   2                      TMPL = read_byte();
 165   2                      TMPH = read_byte();
 166   2                      temp = TMPL / 16 + TMPH * 16;
 167   2                      P0 = table[temp/10%10];
 168   2                      P2 = 6;
 169   2                      Delay_1ms(5);
 170   2                      P0 = table[temp%10];
 171   2                      P2 = 7;
 172   2                      Delay_1ms(5);
 173   2              }
 174   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    338    ----
   CONSTANT SIZE    =     10    ----
C51 COMPILER V9.01   DS18B20                                                               07/05/2016 15:59:06 PAGE 4   

   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
