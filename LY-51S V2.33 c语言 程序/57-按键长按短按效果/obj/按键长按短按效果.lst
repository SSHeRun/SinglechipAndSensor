C51 COMPILER V7.06   __¼ü_¤___Ì_____û                                                      06/15/2010 18:28:31 PAGE 1   


C51 COMPILER V7.06, COMPILATION OF MODULE __¼ü_¤___Ì_____û
OBJECT MODULE PLACED IN .\obj\°´¼ü³¤°´¶Ì°´Ğ§¹û.obj
COMPILER INVOKED BY: d:\Keil\C51\BIN\C51.EXE °´¼ü³¤°´¶Ì°´Ğ§¹û.c BROWSE DEBUG OBJECTEXTEND PRINT(.\obj\°´¼ü³¤°´¶Ì°´Ğ§¹û.l
                    -st) OBJECT(.\obj\°´¼ü³¤°´¶Ì°´Ğ§¹û.obj)

stmt level    source

   1          /*-----------------------------------------------
   2            Ãû³Æ£ºµ¥¸ö¶ÀÁ¢°´¼ü¿ØÖÆ
   3            ÂÛÌ³£ºwww.doflye.net
   4            ±àĞ´£ºshifang
   5            ÈÕÆÚ£º2009.5
   6            ĞŞ¸Ä£ºÎŞ
   7            ÄÚÈİ£º°´¼ü¼Ó¼õÊı×Ö£¬¶à¸öÊıÂë¹ÜÏÔÊ¾£¬Ê¹ÓÃ¶¨Ê±Æ÷×öÊıÂë¹Ü¶¯Ì¬É¨Ãè ²¢Çø±ğ³¤°´¶Ì°´Ğ§¹û£¬ÍêÈ«¿ÉÒÔÓ¦ÓÃµÄÊµ¼ÊÉú²
             -úÖĞ
   8          ------------------------------------------------*/
   9          #include<reg52.h> //°üº¬Í·ÎÄ¼ş£¬Ò»°ãÇé¿ö²»ĞèÒª¸Ä¶¯£¬Í·ÎÄ¼ş°üº¬ÌØÊâ¹¦ÄÜ¼Ä´æÆ÷µÄ¶¨Òå
  10          
  11          sbit KEY_ADD=P3^3;  //¶¨Òå°´¼üÊäÈë¶Ë¿Ú
  12          sbit KEY_DEC=P3^4;
  13          
  14          #define DataPort P0 //¶¨ÒåÊı¾İ¶Ë¿Ú ³ÌĞòÖĞÓöµ½DataPort ÔòÓÃP0 Ìæ»»
  15          sbit LATCH1=P2^2;//¶¨ÒåËø´æÊ¹ÄÜ¶Ë¿Ú ¶ÎËø´æ
  16          sbit LATCH2=P2^3;//                 Î»Ëø´æ
  17          
  18          unsigned char code dofly_DuanMa[10]={0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f};// ÏÔÊ¾¶ÎÂëÖµ0~9
  19          unsigned char code dofly_WeiMa[]={0xfe,0xfd,0xfb,0xf7,0xef,0xdf,0xbf,0x7f};//·Ö±ğ¶ÔÓ¦ÏàÓ¦µÄÊıÂë¹ÜµãÁÁ,¼´Î»
             -Âë
  20          unsigned char TempData[8]; //´æ´¢ÏÔÊ¾ÖµµÄÈ«¾Ö±äÁ¿
  21          
  22          void DelayUs2x(unsigned char t);//º¯ÊıÉùÃ÷ 
  23          void DelayMs(unsigned char t);
  24          void Display(unsigned char FirstBit,unsigned char Num);
  25          void Init_Timer0(void);
  26          /*------------------------------------------------
  27                              Ö÷º¯Êı
  28          ------------------------------------------------*/
  29          void main (void)
  30          {
  31   1      unsigned char num=0,key_press_num;                
  32   1      KEY_ADD=1; //°´¼üÊäÈë¶Ë¿ÚµçÆ½ÖÃ¸ß
  33   1      KEY_DEC=1;
  34   1      Init_Timer0();
  35   1      
  36   1      while (1)         //Ö÷Ñ­»·
  37   1        {
  38   2      
  39   2        if(!KEY_ADD)  //Èç¹û¼ì²âµ½µÍµçÆ½£¬ËµÃ÷°´¼ü°´ÏÂ
  40   2          {
  41   3               DelayMs(10); //ÑÓÊ±È¥¶¶£¬Ò»°ã10-20ms
  42   3           if(!KEY_ADD)     //ÔÙ´ÎÈ·ÈÏ°´¼üÊÇ·ñ°´ÏÂ£¬Ã»ÓĞ°´ÏÂÔòÍË³ö
  43   3                 {
  44   4                 while(!KEY_ADD)
  45   4                  {
  46   5                      key_press_num++;
  47   5              DelayMs(10);           //10x200=2000ms=2s 
  48   5                      if(key_press_num==200) //´óÔ¼2s
  49   5                        {
  50   6                         key_press_num=0;    //Èç¹û´ïµ½³¤°´¼ü±ê×¼ Ôò½øÈë³¤°´¼ü¶¯×÷
  51   6                 while(!KEY_ADD)     //ÕâÀïÓÃÓÚÊ¶±ğÊÇ·ñ°´¼ü»¹ÔÚ°´ÏÂ£¬Èç¹û°´ÏÂÖ´ĞĞÏà¹Ø¶¯×÷£¬·ñÔòÍË³ö
  52   6                             {
C51 COMPILER V7.06   __¼ü_¤___Ì_____û                                                      06/15/2010 18:28:31 PAGE 2   

  53   7                              if(num<99)    //¼Ó²Ù×÷
  54   7                            num++;
  55   7                                      //¼´Ê±°ÑÏÔÊ¾Êı¾İ´¦Àí£¬Èç¹ûÈ¥µôÏÂÃæ2¾ä´¦ÀíĞÅÏ¢£¬Êµ¼ÊÉÏ¿´²»µ½½¥±äĞ§¹û£¬¶øÊÇ¿´µ½Ìø±äĞ§¹û
  56   7                                      //ÓÃ»§¿ÉÒÔ×ÔĞĞÆÁ±Î²âÊÔ
  57   7                                      TempData[0]=dofly_DuanMa[num/10];//·Ö½âÏÔÊ¾ĞÅÏ¢£¬ÈçÒªÏÔÊ¾68£¬Ôò68/10=6  68%10=8  
  58   7                          TempData[1]=dofly_DuanMa[num%10];
  59   7                      DelayMs(50);//ÓÃÓÚµ÷½Ú³¤°´Ñ­»·²Ù×÷µÄËÙ¶È£¬¿ÉÒÔ×ÔĞĞµ÷Õû´ËÖµÒÔ±ã´ïµ½×î¼ÑĞ§¹û
  60   7                                      }
  61   6                          }
  62   5                      }
  63   4            key_press_num=0;//·ÀÖ¹ÀÛ¼ÓÔì³É´íÎóÊ¶±ğ
  64   4                         if(num<99)    //¼Ó²Ù×÷
  65   4                        num++;
  66   4                 }
  67   3              }
  68   2      
  69   2       if(!KEY_DEC)  //Èç¹û¼ì²âµ½µÍµçÆ½£¬ËµÃ÷°´¼ü°´ÏÂ
  70   2          {
  71   3               DelayMs(10); //ÑÓÊ±È¥¶¶£¬Ò»°ã10-20ms
  72   3           if(!KEY_DEC)     //ÔÙ´ÎÈ·ÈÏ°´¼üÊÇ·ñ°´ÏÂ£¬Ã»ÓĞ°´ÏÂÔòÍË³ö
  73   3                 {
  74   4                 while(!KEY_DEC)
  75   4                  {
  76   5                      key_press_num++;
  77   5              DelayMs(10);
  78   5                      if(key_press_num==200) //´óÔ¼2s
  79   5                        {
  80   6                         key_press_num=0;
  81   6                 while(!KEY_DEC)
  82   6                             {
  83   7                              if(num>0)  //¼õ²Ù×÷
  84   7                             num--;
  85   7                                      TempData[0]=dofly_DuanMa[num/10];//·Ö½âÏÔÊ¾ĞÅÏ¢£¬ÈçÒªÏÔÊ¾68£¬Ôò68/10=6  68%10=8  
  86   7                          TempData[1]=dofly_DuanMa[num%10];
  87   7                      DelayMs(50);//ÓÃÓÚµ÷½Ú³¤°´Ñ­»·²Ù×÷µÄËÙ¶È
  88   7                                      }
  89   6                          }
  90   5                      }
  91   4            key_press_num=0;//·ÀÖ¹ÀÛ¼ÓÔì³É´íÎóÊ¶±ğ
  92   4                     if(num>0)  //¼õ²Ù×÷
  93   4                        num--;
  94   4                      
  95   4                 }
  96   3              }
  97   2                 TempData[0]=dofly_DuanMa[num/10];//·Ö½âÏÔÊ¾ĞÅÏ¢£¬ÈçÒªÏÔÊ¾68£¬Ôò68/10=6  68%10=8  
  98   2                 TempData[1]=dofly_DuanMa[num%10];
  99   2                // Display(0,8); //ÏÔÊ¾È«²¿8Î»
 100   2           //Ö÷Ñ­»·ÖĞÌí¼ÓÆäËûĞèÒªÒ»Ö±¹¤×÷µÄ³ÌĞò
 101   2              
 102   2        }
 103   1      }
 104          /*------------------------------------------------
 105           uSÑÓÊ±º¯Êı£¬º¬ÓĞÊäÈë²ÎÊı unsigned char t£¬ÎŞ·µ»ØÖµ
 106           unsigned char ÊÇ¶¨ÒåÎŞ·ûºÅ×Ö·û±äÁ¿£¬ÆäÖµµÄ·¶Î§ÊÇ
 107           0~255 ÕâÀïÊ¹ÓÃ¾§Õñ12M£¬¾«È·ÑÓÊ±ÇëÊ¹ÓÃ»ã±à,´óÖÂÑÓÊ±
 108           ³¤¶ÈÈçÏÂ T=tx2+5 uS 
 109          ------------------------------------------------*/
 110          void DelayUs2x(unsigned char t)
 111          {   
 112   1       while(--t);
 113   1      }
 114          /*------------------------------------------------
C51 COMPILER V7.06   __¼ü_¤___Ì_____û                                                      06/15/2010 18:28:31 PAGE 3   

 115           mSÑÓÊ±º¯Êı£¬º¬ÓĞÊäÈë²ÎÊı unsigned char t£¬ÎŞ·µ»ØÖµ
 116           unsigned char ÊÇ¶¨ÒåÎŞ·ûºÅ×Ö·û±äÁ¿£¬ÆäÖµµÄ·¶Î§ÊÇ
 117           0~255 ÕâÀïÊ¹ÓÃ¾§Õñ12M£¬¾«È·ÑÓÊ±ÇëÊ¹ÓÃ»ã±à
 118          ------------------------------------------------*/
 119          void DelayMs(unsigned char t)
 120          {
 121   1           
 122   1       while(t--)
 123   1       {
 124   2           //´óÖÂÑÓÊ±1mS
 125   2           DelayUs2x(245);
 126   2               DelayUs2x(245);
 127   2       }
 128   1      }
 129          /*------------------------------------------------
 130           ÏÔÊ¾º¯Êı£¬ÓÃÓÚ¶¯Ì¬É¨ÃèÊıÂë¹Ü
 131           ÊäÈë²ÎÊı FirstBit ±íÊ¾ĞèÒªÏÔÊ¾µÄµÚÒ»Î»£¬Èç¸³Öµ2±íÊ¾´ÓµÚÈı¸öÊıÂë¹Ü¿ªÊ¼ÏÔÊ¾
 132           ÈçÊäÈë0±íÊ¾´ÓµÚÒ»¸öÏÔÊ¾¡£
 133           Num±íÊ¾ĞèÒªÏÔÊ¾µÄÎ»Êı£¬ÈçĞèÒªÏÔÊ¾99Á½Î»ÊıÖµÔò¸ÃÖµÊäÈë2
 134          ------------------------------------------------*/
 135          void Display(unsigned char FirstBit,unsigned char Num)
 136          {
 137   1            static unsigned char i=0;
 138   1                
 139   1      
 140   1                 DataPort=0;   //Çå¿ÕÊı¾İ£¬·ÀÖ¹ÓĞ½»ÌæÖØÓ°
 141   1             LATCH1=1;     //¶ÎËø´æ
 142   1             LATCH1=0;
 143   1      
 144   1             DataPort=dofly_WeiMa[i+FirstBit]; //È¡Î»Âë 
 145   1             LATCH2=1;     //Î»Ëø´æ
 146   1             LATCH2=0;
 147   1      
 148   1             DataPort=TempData[i]; //È¡ÏÔÊ¾Êı¾İ£¬¶ÎÂë
 149   1             LATCH1=1;     //¶ÎËø´æ
 150   1             LATCH1=0;
 151   1             
 152   1                 i++;
 153   1             if(i==Num)
 154   1                    i=0;
 155   1      
 156   1      
 157   1      }
 158          /*------------------------------------------------
 159                              ¶¨Ê±Æ÷³õÊ¼»¯×Ó³ÌĞò
 160          ------------------------------------------------*/
 161          void Init_Timer0(void)
 162          {
 163   1       TMOD |= 0x01;    //Ê¹ÓÃÄ£Ê½1£¬16Î»¶¨Ê±Æ÷£¬Ê¹ÓÃ"|"·ûºÅ¿ÉÒÔÔÚÊ¹ÓÃ¶à¸ö¶¨Ê±Æ÷Ê±²»ÊÜÓ°Ïì                 
 164   1       //TH0=0x00;          //¸ø¶¨³õÖµ
 165   1       //TL0=0x00;
 166   1       EA=1;            //×ÜÖĞ¶Ï´ò¿ª
 167   1       ET0=1;           //¶¨Ê±Æ÷ÖĞ¶Ï´ò¿ª
 168   1       TR0=1;           //¶¨Ê±Æ÷¿ª¹Ø´ò¿ª
 169   1      }
 170          /*------------------------------------------------
 171                           ¶¨Ê±Æ÷ÖĞ¶Ï×Ó³ÌĞò
 172          ------------------------------------------------*/
 173          void Timer0_isr(void) interrupt 1 
 174          {
 175   1       TH0=(65536-2000)/256;            //ÖØĞÂ¸³Öµ 2ms
 176   1       TL0=(65536-2000)%256;
C51 COMPILER V7.06   __¼ü_¤___Ì_____û                                                      06/15/2010 18:28:31 PAGE 4   

 177   1       
 178   1       Display(0,8);
 179   1      
 180   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    299    ----
   CONSTANT SIZE    =     18    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      9       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
