C51 COMPILER V7.06   _ÀÁ___¼üÒÀ_ÎÊ_ÈëÊı_İ                                                  09/10/2012 09:24:25 PAGE 1   


C51 COMPILER V7.06, COMPILATION OF MODULE _ÀÁ___¼üÒÀ_ÎÊ_ÈëÊı_İ
OBJECT MODULE PLACED IN .\obj\¶ÀÁ¢°´¼üÒÀ´ÎÊäÈëÊı¾İ.obj
COMPILER INVOKED BY: d:\Keil\C51\BIN\C51.EXE ¶ÀÁ¢°´¼üÒÀ´ÎÊäÈëÊı¾İ.c BROWSE DEBUG OBJECTEXTEND PRINT(.\obj\¶ÀÁ¢°´¼üÒÀ´ÎÊä
                    -ÈëÊı¾İ.lst) OBJECT(.\obj\¶ÀÁ¢°´¼üÒÀ´ÎÊäÈëÊı¾İ.obj)

stmt level    source

   1          /*-----------------------------------------------
   2            Ãû³Æ£ºµ¥¸ö¶ÀÁ¢°´¼üÒÀ´ÎÊäÈë¿ØÖÆ
   3            ÂÛÌ³£ºwww.doflye.net
   4            ±àĞ´£ºshifang
   5            ÈÕÆÚ£º2009.5
   6            ĞŞ¸Ä£ºÎŞ
   7            ÄÚÈİ£ºÈç¼ÆËãÆ÷ÊäÈëÊı¾İĞÎÊ½ÏàÍ¬ ´Ó×óÍùÓÒ
   8          ------------------------------------------------*/
   9          #include<reg52.h> //°üº¬Í·ÎÄ¼ş£¬Ò»°ãÇé¿ö²»ĞèÒª¸Ä¶¯£¬Í·ÎÄ¼ş°üº¬ÌØÊâ¹¦ÄÜ¼Ä´æÆ÷µÄ¶¨Òå
  10          /*------------------------------------------------
  11                              ¶¨Òå°´¼ü
  12          ------------------------------------------------*/
  13          sbit KEY1=P3^0;  //¶¨Òå°´¼üÊäÈë¶Ë¿Ú
  14          sbit KEY2=P3^1;
  15          sbit KEY3=P3^2;
  16          sbit KEY4=P3^3;
  17          sbit KEY5=P3^4;
  18          sbit KEY6=P3^5;
  19          sbit KEY7=P3^6;
  20          sbit KEY8=P3^7;
  21          
  22          /*------------------------------------------------
  23                             ¶¨ÒåÊıÂë¹Ü½Ó¿Ú
  24          ------------------------------------------------*/
  25          #define DataPort P0 //¶¨ÒåÊı¾İ¶Ë¿Ú ³ÌĞòÖĞÓöµ½DataPort ÔòÓÃP0 Ìæ»»
  26          sbit LATCH1=P2^2;//¶¨ÒåËø´æÊ¹ÄÜ¶Ë¿Ú ¶ÎËø´æ
  27          sbit LATCH2=P2^3;//                 Î»Ëø´æ
  28          
  29          unsigned char code dofly_DuanMa[10]={0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f};// ÏÔÊ¾¶ÎÂëÖµ0~9
  30          unsigned char code dofly_WeiMa[]={0xfe,0xfd,0xfb,0xf7,0xef,0xdf,0xbf,0x7f};//·Ö±ğ¶ÔÓ¦ÏàÓ¦µÄÊıÂë¹ÜµãÁÁ,¼´Î»
             -Âë
  31          unsigned char TempData[10]; //´æ´¢ÏÔÊ¾ÖµµÄÈ«¾Ö±äÁ¿
  32          /*------------------------------------------------
  33                             º¯ÊıÉùÃ÷
  34          ------------------------------------------------*/
  35          void DelayUs2x(unsigned char t);//us¼¶ÑÓÊ±º¯ÊıÉùÃ÷ 
  36          void DelayMs(unsigned char t); //ms¼¶ÑÓÊ±
  37          void Display(unsigned char FirstBit,unsigned char Num);//ÊıÂë¹ÜÏÔÊ¾º¯Êı
  38          unsigned char KeyScan(void);//¼üÅÌÉ¨Ãè
  39          void Init_Timer0(void);//¶¨Ê±Æ÷³õÊ¼»¯
  40          /*------------------------------------------------
  41                              Ö÷º¯Êı
  42          ------------------------------------------------*/
  43          void main (void)
  44          {
  45   1      unsigned char num,i,j;                  
  46   1      
  47   1      Init_Timer0();
  48   1      
  49   1      while (1)         //Ö÷Ñ­»·
  50   1        {
  51   2      
  52   2      
  53   2       num=KeyScan();
C51 COMPILER V7.06   _ÀÁ___¼üÒÀ_ÎÊ_ÈëÊı_İ                                                  09/10/2012 09:24:25 PAGE 2   

  54   2       if(num)
  55   2         {
  56   3        if(i<8)
  57   3          TempData[i]=dofly_DuanMa[num];
  58   3              i++;
  59   3              if(i==9)//¶à³öÒ»¸ö°´¼üÊäÈëÎªÁËÇåÆÁ Ô­±¾Ó¦¸ÃÎª8
  60   3                {
  61   4                i=0;
  62   4            for(j=0;j<8;j++)//ÇåÆÁ
  63   4               TempData[j]=0;
  64   4             }
  65   3         }    
  66   2        }
  67   1      }
  68          /*------------------------------------------------
  69           uSÑÓÊ±º¯Êı£¬º¬ÓĞÊäÈë²ÎÊı unsigned char t£¬ÎŞ·µ»ØÖµ
  70           unsigned char ÊÇ¶¨ÒåÎŞ·ûºÅ×Ö·û±äÁ¿£¬ÆäÖµµÄ·¶Î§ÊÇ
  71           0~255 ÕâÀïÊ¹ÓÃ¾§Õñ12M£¬¾«È·ÑÓÊ±ÇëÊ¹ÓÃ»ã±à,´óÖÂÑÓÊ±
  72           ³¤¶ÈÈçÏÂ T=tx2+5 uS 
  73          ------------------------------------------------*/
  74          void DelayUs2x(unsigned char t)
  75          {   
  76   1       while(--t);
  77   1      }
  78          /*------------------------------------------------
  79           mSÑÓÊ±º¯Êı£¬º¬ÓĞÊäÈë²ÎÊı unsigned char t£¬ÎŞ·µ»ØÖµ
  80           unsigned char ÊÇ¶¨ÒåÎŞ·ûºÅ×Ö·û±äÁ¿£¬ÆäÖµµÄ·¶Î§ÊÇ
  81           0~255 ÕâÀïÊ¹ÓÃ¾§Õñ12M£¬¾«È·ÑÓÊ±ÇëÊ¹ÓÃ»ã±à
  82          ------------------------------------------------*/
  83          void DelayMs(unsigned char t)
  84          {
  85   1           
  86   1       while(t--)
  87   1       {
  88   2           //´óÖÂÑÓÊ±1mS
  89   2           DelayUs2x(245);
  90   2               DelayUs2x(245);
  91   2       }
  92   1      }
  93          /*------------------------------------------------
  94           ÏÔÊ¾º¯Êı£¬ÓÃÓÚ¶¯Ì¬É¨ÃèÊıÂë¹Ü
  95           ÊäÈë²ÎÊı FirstBit ±íÊ¾ĞèÒªÏÔÊ¾µÄµÚÒ»Î»£¬Èç¸³Öµ2±íÊ¾´ÓµÚÈı¸öÊıÂë¹Ü¿ªÊ¼ÏÔÊ¾
  96           ÈçÊäÈë0±íÊ¾´ÓµÚÒ»¸öÏÔÊ¾¡£
  97           Num±íÊ¾ĞèÒªÏÔÊ¾µÄÎ»Êı£¬ÈçĞèÒªÏÔÊ¾99Á½Î»ÊıÖµÔò¸ÃÖµÊäÈë2
  98          ------------------------------------------------*/
  99          void Display(unsigned char FirstBit,unsigned char Num)
 100          {
 101   1            static unsigned char i=0;
 102   1                
 103   1      
 104   1                 DataPort=0;   //Çå¿ÕÊı¾İ£¬·ÀÖ¹ÓĞ½»ÌæÖØÓ°
 105   1             LATCH1=1;     //¶ÎËø´æ
 106   1             LATCH1=0;
 107   1      
 108   1             DataPort=dofly_WeiMa[i+FirstBit]; //È¡Î»Âë 
 109   1             LATCH2=1;     //Î»Ëø´æ
 110   1             LATCH2=0;
 111   1      
 112   1             DataPort=TempData[i]; //È¡ÏÔÊ¾Êı¾İ£¬¶ÎÂë
 113   1             LATCH1=1;     //¶ÎËø´æ
 114   1             LATCH1=0;
 115   1             
C51 COMPILER V7.06   _ÀÁ___¼üÒÀ_ÎÊ_ÈëÊı_İ                                                  09/10/2012 09:24:25 PAGE 3   

 116   1                 i++;
 117   1             if(i==Num)
 118   1                    i=0;
 119   1      
 120   1      
 121   1      }
 122          /*------------------------------------------------
 123                              ¶¨Ê±Æ÷³õÊ¼»¯×Ó³ÌĞò
 124          ------------------------------------------------*/
 125          void Init_Timer0(void)
 126          {
 127   1       TMOD |= 0x01;    //Ê¹ÓÃÄ£Ê½1£¬16Î»¶¨Ê±Æ÷£¬Ê¹ÓÃ"|"·ûºÅ¿ÉÒÔÔÚÊ¹ÓÃ¶à¸ö¶¨Ê±Æ÷Ê±²»ÊÜÓ°Ïì                 
 128   1       //TH0=0x00;          //¸ø¶¨³õÖµ
 129   1       //TL0=0x00;
 130   1       EA=1;            //×ÜÖĞ¶Ï´ò¿ª
 131   1       ET0=1;           //¶¨Ê±Æ÷ÖĞ¶Ï´ò¿ª
 132   1       TR0=1;           //¶¨Ê±Æ÷¿ª¹Ø´ò¿ª
 133   1      }
 134          /*------------------------------------------------
 135                           ¶¨Ê±Æ÷ÖĞ¶Ï×Ó³ÌĞò
 136          ------------------------------------------------*/
 137          void Timer0_isr(void) interrupt 1 
 138          {
 139   1       TH0=(65536-2000)/256;            //ÖØĞÂ¸³Öµ 2ms
 140   1       TL0=(65536-2000)%256;
 141   1       
 142   1       Display(0,8);       // µ÷ÓÃÊıÂë¹ÜÉ¨Ãè
 143   1      
 144   1      }
 145          
 146          /*------------------------------------------------
 147                      °´¼üÉ¨Ãèº¯Êı£¬·µ»ØÉ¨Ãè¼üÖµ
 148          ------------------------------------------------*/
 149          unsigned char KeyScan(void)
 150          {
 151   1      /********************************************************/  
 152   1      if(!KEY1)  //Èç¹û¼ì²âµ½µÍµçÆ½£¬ËµÃ÷°´¼ü°´ÏÂ
 153   1          {
 154   2               DelayMs(10); //ÑÓÊ±È¥¶¶£¬Ò»°ã10-20ms
 155   2           if(!KEY1)     //ÔÙ´ÎÈ·ÈÏ°´¼üÊÇ·ñ°´ÏÂ£¬Ã»ÓĞ°´ÏÂÔòÍË³ö
 156   2                 {
 157   3              while(!KEY1);//Èç¹ûÈ·ÈÏ°´ÏÂ°´¼üµÈ´ı°´¼üÊÍ·Å£¬Ã»ÓĞÔòÍË³ö
 158   3                     {
 159   4                         return 1;
 160   4                              }
 161   3                 }
 162   2              }
 163   1      /********************************************************/  
 164   1      else if(!KEY2)  //Èç¹û¼ì²âµ½µÍµçÆ½£¬ËµÃ÷°´¼ü°´ÏÂ
 165   1          {
 166   2               DelayMs(10); //ÑÓÊ±È¥¶¶£¬Ò»°ã10-20ms
 167   2           if(!KEY2)     //ÔÙ´ÎÈ·ÈÏ°´¼üÊÇ·ñ°´ÏÂ£¬Ã»ÓĞ°´ÏÂÔòÍË³ö
 168   2                 {
 169   3              while(!KEY2);//Èç¹ûÈ·ÈÏ°´ÏÂ°´¼üµÈ´ı°´¼üÊÍ·Å£¬Ã»ÓĞÔòÍË³ö
 170   3                     {
 171   4                         return 2;
 172   4                              }
 173   3                 }
 174   2              }
 175   1      /********************************************************/  
 176   1      else if(!KEY3)  //Èç¹û¼ì²âµ½µÍµçÆ½£¬ËµÃ÷°´¼ü°´ÏÂ
 177   1          {
C51 COMPILER V7.06   _ÀÁ___¼üÒÀ_ÎÊ_ÈëÊı_İ                                                  09/10/2012 09:24:25 PAGE 4   

 178   2               DelayMs(10); //ÑÓÊ±È¥¶¶£¬Ò»°ã10-20ms
 179   2           if(!KEY3)     //ÔÙ´ÎÈ·ÈÏ°´¼üÊÇ·ñ°´ÏÂ£¬Ã»ÓĞ°´ÏÂÔòÍË³ö
 180   2                 {
 181   3              while(!KEY3);//Èç¹ûÈ·ÈÏ°´ÏÂ°´¼üµÈ´ı°´¼üÊÍ·Å£¬Ã»ÓĞÔòÍË³ö
 182   3                     {
 183   4                         return 3;
 184   4                              }
 185   3                 }
 186   2              }
 187   1      /********************************************************/  
 188   1      else if(!KEY4)  //Èç¹û¼ì²âµ½µÍµçÆ½£¬ËµÃ÷°´¼ü°´ÏÂ
 189   1          {
 190   2               DelayMs(10); //ÑÓÊ±È¥¶¶£¬Ò»°ã10-20ms
 191   2           if(!KEY4)     //ÔÙ´ÎÈ·ÈÏ°´¼üÊÇ·ñ°´ÏÂ£¬Ã»ÓĞ°´ÏÂÔòÍË³ö
 192   2                 {
 193   3              while(!KEY4);//Èç¹ûÈ·ÈÏ°´ÏÂ°´¼üµÈ´ı°´¼üÊÍ·Å£¬Ã»ÓĞÔòÍË³ö
 194   3                     {
 195   4                         return 4;
 196   4                              }
 197   3                 }
 198   2              }
 199   1      /********************************************************/  
 200   1      else if(!KEY5)  //Èç¹û¼ì²âµ½µÍµçÆ½£¬ËµÃ÷°´¼ü°´ÏÂ
 201   1          {
 202   2               DelayMs(10); //ÑÓÊ±È¥¶¶£¬Ò»°ã10-20ms
 203   2           if(!KEY5)     //ÔÙ´ÎÈ·ÈÏ°´¼üÊÇ·ñ°´ÏÂ£¬Ã»ÓĞ°´ÏÂÔòÍË³ö
 204   2                 {
 205   3              while(!KEY5);//Èç¹ûÈ·ÈÏ°´ÏÂ°´¼üµÈ´ı°´¼üÊÍ·Å£¬Ã»ÓĞÔòÍË³ö
 206   3                     {
 207   4                         return 5;
 208   4                              }
 209   3                 }
 210   2              }
 211   1      /********************************************************/  
 212   1      else if(!KEY6)  //Èç¹û¼ì²âµ½µÍµçÆ½£¬ËµÃ÷°´¼ü°´ÏÂ
 213   1          {
 214   2               DelayMs(10); //ÑÓÊ±È¥¶¶£¬Ò»°ã10-20ms
 215   2           if(!KEY6)     //ÔÙ´ÎÈ·ÈÏ°´¼üÊÇ·ñ°´ÏÂ£¬Ã»ÓĞ°´ÏÂÔòÍË³ö
 216   2                 {
 217   3              while(!KEY6);//Èç¹ûÈ·ÈÏ°´ÏÂ°´¼üµÈ´ı°´¼üÊÍ·Å£¬Ã»ÓĞÔòÍË³ö
 218   3                     {
 219   4                         return 6;
 220   4                              }
 221   3                 }
 222   2              }
 223   1      /********************************************************/  
 224   1      else if(!KEY7)  //Èç¹û¼ì²âµ½µÍµçÆ½£¬ËµÃ÷°´¼ü°´ÏÂ
 225   1          {
 226   2               DelayMs(10); //ÑÓÊ±È¥¶¶£¬Ò»°ã10-20ms
 227   2           if(!KEY7)     //ÔÙ´ÎÈ·ÈÏ°´¼üÊÇ·ñ°´ÏÂ£¬Ã»ÓĞ°´ÏÂÔòÍË³ö
 228   2                 {
 229   3              while(!KEY7);//Èç¹ûÈ·ÈÏ°´ÏÂ°´¼üµÈ´ı°´¼üÊÍ·Å£¬Ã»ÓĞÔòÍË³ö
 230   3                     {
 231   4                         return 7;
 232   4                              }
 233   3                 }
 234   2              }
 235   1      /********************************************************/  
 236   1      else if(!KEY8)  //Èç¹û¼ì²âµ½µÍµçÆ½£¬ËµÃ÷°´¼ü°´ÏÂ
 237   1          {
 238   2               DelayMs(10); //ÑÓÊ±È¥¶¶£¬Ò»°ã10-20ms
 239   2           if(!KEY8)     //ÔÙ´ÎÈ·ÈÏ°´¼üÊÇ·ñ°´ÏÂ£¬Ã»ÓĞ°´ÏÂÔòÍË³ö
C51 COMPILER V7.06   _ÀÁ___¼üÒÀ_ÎÊ_ÈëÊı_İ                                                  09/10/2012 09:24:25 PAGE 5   

 240   2                 {
 241   3              while(!KEY8);//Èç¹ûÈ·ÈÏ°´ÏÂ°´¼üµÈ´ı°´¼üÊÍ·Å£¬Ã»ÓĞÔòÍË³ö
 242   3                     {
 243   4                         return 8;
 244   4                              }
 245   3                 }
 246   2              }
 247   1      /********************************************************/  
 248   1      else
 249   1          return 0;
 250   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    323    ----
   CONSTANT SIZE    =     18    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     11       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
