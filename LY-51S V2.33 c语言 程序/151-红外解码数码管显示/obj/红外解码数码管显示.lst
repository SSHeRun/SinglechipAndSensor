C51 COMPILER V7.06   _ìÍâ½âÂëÊıÂë_Ü_ÔÊ_                                                    10/24/2011 15:11:34 PAGE 1   


C51 COMPILER V7.06, COMPILATION OF MODULE _ìÍâ½âÂëÊıÂë_Ü_ÔÊ_
OBJECT MODULE PLACED IN .\obj\ºìÍâ½âÂëÊıÂë¹ÜÏÔÊ¾.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE ºìÍâ½âÂëÊıÂë¹ÜÏÔÊ¾.c BROWSE DEBUG OBJECTEXTEND PRINT(.\obj\ºìÍâ½âÂëÊıÂë¹ÜÏÔ
                    -Ê¾.lst) OBJECT(.\obj\ºìÍâ½âÂëÊıÂë¹ÜÏÔÊ¾.obj)

stmt level    source

   1          /*-----------------------------------------------
   2            Ãû³Æ£ºÒ£¿ØÆ÷ºìÍâ½âÂëÊıÂë¹ÜÏÔÊ¾
   3            ÂÛÌ³£ºwww.doflye.net
   4            ±àĞ´£ºshifang
   5            ÈÕÆÚ£º2009.5
   6            ĞŞ¸Ä£ºÎŞ
   7            ÄÚÈİ£º°´ÅäÌ×Ò£¿ØÆ÷ÉÏ8Î»ÊıÂë¹ÜÏÔÊ¾ ÓÃ»§Âë ÓÃ»§Âë Êı¾İÂë Êı¾İ·´Âë£¬²âµÃÍ¬Ò»¸ö°´¼üµÄ¼üÖµ²»±ä£¬±íÊ¾½âÂëÕıÈ·£
             -¬Ê¹ÓÃ12M¾§Õñ
   8                  Ó¦±ÜÃâ¿É¼û¹â¡¢ÈÕ¹âµÆ¸ÉÈÅ£¬ÒòÎª½ÓÊÕÍ·Ã»ÓĞÊ¹ÓÃÂË¹âÆ¬¡£
   9          ------------------------------------------------*/
  10          #include<reg52.h>    //°üº¬Í·ÎÄ¼ş£¬Ò»°ãÇé¿ö²»ĞèÒª¸Ä¶¯£¬Í·ÎÄ¼ş°üº¬ÌØÊâ¹¦ÄÜ¼Ä´æÆ÷µÄ¶¨Òå
  11          
  12          sbit IR=P3^2;  //ºìÍâ½Ó¿Ú±êÖ¾
  13          
  14          #define DataPort P0 //¶¨ÒåÊı¾İ¶Ë¿Ú ³ÌĞòÖĞÓöµ½DataPort ÔòÓÃP0 Ìæ»»
  15          sbit LATCH1=P2^2;//¶¨ÒåËø´æÊ¹ÄÜ¶Ë¿Ú ¶ÎËø´æ
  16          sbit LATCH2=P2^3;//                 Î»Ëø´æ
  17          /*------------------------------------------------
  18                          È«¾Ö±äÁ¿ÉùÃ÷
  19          ------------------------------------------------*/
  20          unsigned char code dofly_DuanMa[16]={0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f,0x77,0x7c,0x39,0x5e
             -,0x79,0x71};// ÏÔÊ¾¶ÎÂëÖµ0~F
  21          unsigned char code dofly_WeiMa[]={0xfe,0xfd,0xfb,0xf7,0xef,0xdf,0xbf,0x7f};//·Ö±ğ¶ÔÓ¦ÏàÓ¦µÄÊıÂë¹ÜµãÁÁ,¼´Î»
             -Âë
  22          unsigned char TempData[8]; //´æ´¢ÏÔÊ¾ÖµµÄÈ«¾Ö±äÁ¿
  23          unsigned char  irtime;//ºìÍâÓÃÈ«¾Ö±äÁ¿
  24          
  25          bit irpro_ok,irok;
  26          unsigned char IRcord[4];
  27          unsigned char irdata[33];
  28          
  29          /*------------------------------------------------
  30                            º¯ÊıÉùÃ÷
  31          ------------------------------------------------*/
  32          
  33          void Ir_work(void);
  34          void Ircordpro(void);
  35          /*------------------------------------------------
  36           ÏÔÊ¾º¯Êı£¬ÓÃÓÚ¶¯Ì¬É¨ÃèÊıÂë¹Ü
  37           ÊäÈë²ÎÊı FirstBit ±íÊ¾ĞèÒªÏÔÊ¾µÄµÚÒ»Î»£¬Èç¸³Öµ2±íÊ¾´ÓµÚÈı¸öÊıÂë¹Ü¿ªÊ¼ÏÔÊ¾
  38           ÈçÊäÈë0±íÊ¾´ÓµÚÒ»¸öÏÔÊ¾¡£
  39           Num±íÊ¾ĞèÒªÏÔÊ¾µÄÎ»Êı£¬ÈçĞèÒªÏÔÊ¾99Á½Î»ÊıÖµÔò¸ÃÖµÊäÈë2
  40          ------------------------------------------------*/
  41          void Display(unsigned char FirstBit,unsigned char Num)
  42          {
  43   1            static unsigned char i=0;
  44   1                
  45   1      
  46   1                 DataPort=0;   //Çå¿ÕÊı¾İ£¬·ÀÖ¹ÓĞ½»ÌæÖØÓ°
  47   1             LATCH1=1;     //¶ÎËø´æ
  48   1             LATCH1=0;
  49   1      
  50   1             DataPort=dofly_WeiMa[i+FirstBit]; //È¡Î»Âë 
  51   1             LATCH2=1;     //Î»Ëø´æ
C51 COMPILER V7.06   _ìÍâ½âÂëÊıÂë_Ü_ÔÊ_                                                    10/24/2011 15:11:34 PAGE 2   

  52   1             LATCH2=0;
  53   1      
  54   1             DataPort=TempData[i]; //È¡ÏÔÊ¾Êı¾İ£¬¶ÎÂë
  55   1             LATCH1=1;     //¶ÎËø´æ
  56   1             LATCH1=0;
  57   1             
  58   1                 i++;
  59   1             if(i==Num)
  60   1                    i=0;
  61   1      
  62   1      
  63   1      }
  64          /*------------------------------------------------
  65                            ¶¨Ê±Æ÷0ÖĞ¶Ï´¦Àí
  66          ------------------------------------------------*/
  67          
  68          void tim0_isr (void) interrupt 1 using 1
  69          {
  70   1        irtime++;  //ÓÃÓÚ¼ÆÊı2¸öÏÂ½µÑØÖ®¼äµÄÊ±¼ä
  71   1      }
  72          /*------------------------------------------------
  73                           ¶¨Ê±Æ÷ÖĞ¶Ï×Ó³ÌĞò
  74          ------------------------------------------------*/
  75          void Timer1_isr(void) interrupt 3 
  76          {
  77   1      
  78   1       TH1=(65536-2000)/256;            //ÖØĞÂ¸³Öµ 2ms
  79   1       TL1=(65536-2000)%256;
  80   1       
  81   1       Display(0,8);       // µ÷ÓÃÊıÂë¹ÜÉ¨Ãè
  82   1      
  83   1      }
  84          /*------------------------------------------------
  85                            Íâ²¿ÖĞ¶Ï0ÖĞ¶Ï´¦Àí
  86          ------------------------------------------------*/
  87          void EX0_ISR (void) interrupt 0 //Íâ²¿ÖĞ¶Ï0·şÎñº¯Êı
  88          {
  89   1        static unsigned char  i;             //½ÓÊÕºìÍâĞÅºÅ´¦Àí
  90   1        static bit startflag;                //ÊÇ·ñ¿ªÊ¼´¦Àí±êÖ¾Î»
  91   1      
  92   1      if(startflag)                         
  93   1         {
  94   2          if(irtime<63&&irtime>=33)//Òıµ¼Âë TC9012µÄÍ·Âë£¬9ms+4.5ms
  95   2                              i=0;
  96   2                      irdata[i]=irtime;//´æ´¢Ã¿¸öµçÆ½µÄ³ÖĞøÊ±¼ä£¬ÓÃÓÚÒÔºóÅĞ¶ÏÊÇ0»¹ÊÇ1
  97   2                      irtime=0;
  98   2                      i++;
  99   2                               if(i==33)
 100   2                              {
 101   3                                       irok=1;
 102   3                                       i=0;
 103   3                                      }
 104   2                }
 105   1               else
 106   1                      {
 107   2                      irtime=0;
 108   2                      startflag=1;
 109   2                      }
 110   1      
 111   1      }
 112          
 113          /*------------------------------------------------
C51 COMPILER V7.06   _ìÍâ½âÂëÊıÂë_Ü_ÔÊ_                                                    10/24/2011 15:11:34 PAGE 3   

 114                          ¶¨Ê±Æ÷0³õÊ¼»¯
 115          ------------------------------------------------*/
 116          void TIM0init(void)//¶¨Ê±Æ÷0³õÊ¼»¯
 117          {
 118   1      
 119   1        TMOD=0x02;//¶¨Ê±Æ÷0¹¤×÷·½Ê½2£¬TH0ÊÇÖØ×°Öµ£¬TL0ÊÇ³õÖµ
 120   1        TH0=0x00; //ÖØÔØÖµ
 121   1        TL0=0x00; //³õÊ¼»¯Öµ
 122   1        ET0=1;    //¿ªÖĞ¶Ï
 123   1        TR0=1;    
 124   1      }
 125          /*------------------------------------------------
 126                              ¶¨Ê±Æ÷³õÊ¼»¯×Ó³ÌĞò
 127          ------------------------------------------------*/
 128          void Init_Timer1(void)
 129          {
 130   1       TMOD |= 0x01;    //Ê¹ÓÃÄ£Ê½1£¬16Î»¶¨Ê±Æ÷£¬Ê¹ÓÃ"|"·ûºÅ¿ÉÒÔÔÚÊ¹ÓÃ¶à¸ö¶¨Ê±Æ÷Ê±²»ÊÜÓ°Ïì                 
 131   1       //TH1=0x00;          //¸ø¶¨³õÖµ
 132   1       //TL1=0x00;
 133   1       EA=1;            //×ÜÖĞ¶Ï´ò¿ª
 134   1       ET1=1;           //¶¨Ê±Æ÷ÖĞ¶Ï´ò¿ª
 135   1       TR1=1;           //¶¨Ê±Æ÷¿ª¹Ø´ò¿ª
 136   1      }
 137          /*------------------------------------------------
 138                            Íâ²¿ÖĞ¶Ï0³õÊ¼»¯
 139          ------------------------------------------------*/
 140          void EX0init(void)
 141          {
 142   1       IT0 = 1;   //Ö¸¶¨Íâ²¿ÖĞ¶Ï0ÏÂ½µÑØ´¥·¢£¬INT0 (P3.2)
 143   1       EX0 = 1;   //Ê¹ÄÜÍâ²¿ÖĞ¶Ï
 144   1       EA = 1;    //¿ª×ÜÖĞ¶Ï
 145   1      }
 146          /*------------------------------------------------
 147                            ¼üÖµ´¦Àí
 148          ------------------------------------------------*/
 149          
 150          void Ir_work(void)//ºìÍâ¼üÖµÉ¢×ª³ÌĞò
 151          {
 152   1      
 153   1              TempData[0]=dofly_DuanMa[IRcord[0]/16];
 154   1                      TempData[1]=dofly_DuanMa[IRcord[0]%16];
 155   1                      TempData[2]=dofly_DuanMa[IRcord[1]/16];
 156   1                      TempData[3]=dofly_DuanMa[IRcord[1]%16];
 157   1                      TempData[4]=dofly_DuanMa[IRcord[2]/16];
 158   1                      TempData[5]=dofly_DuanMa[IRcord[2]%16];
 159   1                      TempData[6]=dofly_DuanMa[IRcord[3]/16];
 160   1                      TempData[7]=dofly_DuanMa[IRcord[3]%16];
 161   1                      //Display(0,8);       // µ÷ÓÃÊıÂë¹ÜÉ¨Ãè
 162   1                        irpro_ok=0;//´¦ÀíÍê³É±êÖ¾
 163   1      
 164   1        }
 165          /*------------------------------------------------
 166                          ºìÍâÂëÖµ´¦Àí
 167          ------------------------------------------------*/
 168          void Ircordpro(void)//ºìÍâÂëÖµ´¦Àíº¯Êı
 169          { 
 170   1        unsigned char i, j, k;
 171   1        unsigned char cord,value;
 172   1      
 173   1        k=1;
 174   1        for(i=0;i<4;i++)      //´¦Àí4¸ö×Ö½Ú
 175   1           {
C51 COMPILER V7.06   _ìÍâ½âÂëÊıÂë_Ü_ÔÊ_                                                    10/24/2011 15:11:34 PAGE 4   

 176   2            for(j=1;j<=8;j++) //´¦Àí1¸ö×Ö½Ú8Î»
 177   2               {
 178   3                cord=irdata[k];
 179   3                if(cord>7)//´óÓÚÄ³ÖµÎª1£¬Õâ¸öºÍ¾§ÕñÓĞ¾ø¶Ô¹ØÏµ£¬ÕâÀïÊ¹ÓÃ12M¼ÆËã£¬´ËÖµ¿ÉÒÔÓĞÒ»¶¨Îó²î
 180   3                   value|=0x80;
 181   3                if(j<8)
 182   3                          {
 183   4                               value>>=1;
 184   4                              }
 185   3                 k++;
 186   3               }
 187   2           IRcord[i]=value;
 188   2           value=0;     
 189   2           } 
 190   1               irpro_ok=1;//´¦ÀíÍê±Ï±êÖ¾Î»ÖÃ1
 191   1      }
 192          
 193          /*------------------------------------------------
 194                              Ö÷º¯Êı
 195          ------------------------------------------------*/
 196          void main(void)
 197          {
 198   1       EX0init(); //³õÊ¼»¯Íâ²¿ÖĞ¶Ï
 199   1       TIM0init();//³õÊ¼»¯¶¨Ê±Æ÷
 200   1       Init_Timer1();
 201   1      
 202   1       while(1)//Ö÷Ñ­»·
 203   1         {
 204   2          if(irok)                        //Èç¹û½ÓÊÕºÃÁË½øĞĞºìÍâ´¦Àí
 205   2                {   
 206   3                 Ircordpro();
 207   3                 irok=0;
 208   3                }
 209   2      
 210   2          if(irpro_ok)                   //Èç¹û´¦ÀíºÃºó½øĞĞ¹¤×÷´¦Àí£¬Èç°´¶ÔÓ¦µÄ°´¼üºóÏÔÊ¾¶ÔÓ¦µÄÊı×ÖµÈ
 211   2                {
 212   3                 Ir_work();
 213   3                }
 214   2         }
 215   1      }
 216            
 217            


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    326    ----
   CONSTANT SIZE    =     24    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     48    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      3    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
