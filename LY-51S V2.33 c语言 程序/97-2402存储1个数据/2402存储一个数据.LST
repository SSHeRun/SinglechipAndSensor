C51 COMPILER V7.06   2402____Ò»_öÊý_Ý                                                      05/24/2010 11:21:06 PAGE 1   


C51 COMPILER V7.06, COMPILATION OF MODULE 2402____Ò»_öÊý_Ý
OBJECT MODULE PLACED IN 2402´æ´¢Ò»¸öÊý¾Ý.OBJ
COMPILER INVOKED BY: d:\Keil\C51\BIN\C51.EXE 2402´æ´¢Ò»¸öÊý¾Ý.c BROWSE DEBUG OBJECTEXTEND

stmt level    source

   1          /*-----------------------------------------------
   2            Ãû³Æ£ºIICÐ­Òé EEPROM24c02
   3            ÂÛÌ³£ºwww.doflye.net
   4            ±àÐ´£ºshifang
   5            ÐÞ¸Ä£ºÎÞ
   6            ÄÚÈÝ£º´Ë³ÌÐòÓÃÓÚ¼ì²âEEPROMÐÔÄÜ£¬²âÊÔ·½·¨ÈçÏÂ£ºÐ´Èë24c02Ò»Ð©Êý¾Ý£¬È»ºóÔÚÄÚ´æÖÐÇå³ýÕâÐ©Êý¾Ý£¬
   7                  µôµçºóÖ÷ÄÚ´æ½«Ê§È¥ÕâÐ©ÐÅÏ¢£¬È»ºó´Ó24c02ÖÐµ÷ÈëÕâÐ©Êý¾Ý¡£¿´ÊÇ·ñÓëÐ´ÈëµÄÏàÍ¬¡£
   8          ------------------------------------------------*/
   9           #include<reg52.h>    //°üº¬Í·ÎÄ¼þ£¬Ò»°ãÇé¿ö²»ÐèÒª¸Ä¶¯£¬Í·ÎÄ¼þ°üº¬ÌØÊâ¹¦ÄÜ¼Ä´æÆ÷µÄ¶¨Òå
  10           #include <intrins.h> //°üº¬NOP¿ÕÖ¸Áîº¯Êý_nop_();
  11          
  12           #define AddWr 0xae   //Ð´Êý¾ÝµØÖ·£¬ÐèÒª²Î¿¼24c02Ð¾Æ¬ÎÄµµ
  13           #define AddRd 0xaf   //¶ÁÊý¾ÝµØÖ·
  14          
  15           
  16           sbit SDA=P1^2;       //¶¨Òå×ÜÏßÁ¬½Ó¶Ë¿Ú
  17           sbit SCL=P1^1;
  18           sbit WP=P1^0;        //Ð´±£»¤£¬ÕâÀï²»Ê¹ÓÃ
  19          
  20          /*------------------------------------------------
  21           uSÑÓÊ±º¯Êý£¬º¬ÓÐÊäÈë²ÎÊý unsigned char t£¬ÎÞ·µ»ØÖµ
  22           unsigned char ÊÇ¶¨ÒåÎÞ·ûºÅ×Ö·û±äÁ¿£¬ÆäÖµµÄ·¶Î§ÊÇ
  23           0~255 ÕâÀïÊ¹ÓÃ¾§Õñ12M£¬¾«È·ÑÓÊ±ÇëÊ¹ÓÃ»ã±à,´óÖÂÑÓÊ±
  24           ³¤¶ÈÈçÏÂ T=tx2+5 uS 
  25          ------------------------------------------------*/
  26          void DelayUs2x(unsigned char t)
  27          {   
  28   1       while(--t);
  29   1      }
  30          /*------------------------------------------------
  31           mSÑÓÊ±º¯Êý£¬º¬ÓÐÊäÈë²ÎÊý unsigned char t£¬ÎÞ·µ»ØÖµ
  32           unsigned char ÊÇ¶¨ÒåÎÞ·ûºÅ×Ö·û±äÁ¿£¬ÆäÖµµÄ·¶Î§ÊÇ
  33           0~255 ÕâÀïÊ¹ÓÃ¾§Õñ12M£¬¾«È·ÑÓÊ±ÇëÊ¹ÓÃ»ã±à
  34          ------------------------------------------------*/
  35          void DelayMs(unsigned char t)
  36          {
  37   1           
  38   1       while(t--)
  39   1       {
  40   2           //´óÖÂÑÓÊ±1mS
  41   2           DelayUs2x(245);
  42   2               DelayUs2x(245);
  43   2       }
  44   1      }
  45          /*------------------------------------------------
  46                              Æô¶¯IIC×ÜÏß
  47          ------------------------------------------------*/
  48          void IIC_Start(void)
  49            {
  50   1         SDA=1;
  51   1         _nop_();_nop_();
  52   1         SCL=1;
  53   1         _nop_();_nop_();
  54   1         SDA=0;
  55   1         _nop_();_nop_();
C51 COMPILER V7.06   2402____Ò»_öÊý_Ý                                                      05/24/2010 11:21:06 PAGE 2   

  56   1         SCL=0;
  57   1        }
  58          
  59          
  60          /*------------------------------------------------
  61                              Í£Ö¹IIC×ÜÏß
  62          ------------------------------------------------*/
  63          void IIC_Stop(void)
  64            {
  65   1         SDA=0;
  66   1         _nop_();
  67   1         SCL=1;
  68   1         _nop_();_nop_();
  69   1         SDA=1;
  70   1         _nop_();_nop_();
  71   1         SCL=0;
  72   1         }
  73          /*------------------------------------------------
  74                     ·¢ËÍÓ¦´ð²¢¼ì²âIIC×ÜÏß
  75          ------------------------------------------------*/
  76          bit Ack(void)
  77             {
  78   1          SDA=1;
  79   1              _nop_();_nop_();
  80   1              SCL=1;
  81   1              _nop_();_nop_();
  82   1              if(SDA)
  83   1                 return 0;//·ÇÓ¦´ð
  84   1              else
  85   1                 return 1;//Ó¦´ð
  86   1              SCL=0;
  87   1              _nop_();_nop_();
  88   1              }
  89          
  90          /*------------------------------------------------
  91                           ·ÇÓ¦´ðIIC×ÜÏß
  92          ------------------------------------------------*/
  93          void No_Ack(void)
  94                  {
  95   1               SDA=1;
  96   1               _nop_();_nop_();
  97   1               SCL=1;
  98   1               _nop_();_nop_();
  99   1               SCL=0;
 100   1               _nop_();_nop_();
 101   1               }
 102          
 103          /*------------------------------------------------
 104                        ·¢ËÍÒ»¸ö×Ö½Ú
 105          ------------------------------------------------*/
 106          void Send_Byte(unsigned char Data)
 107                   { 
 108   1                unsigned char BitCounter=8;
 109   1                unsigned char temp;
 110   1      
 111   1                do
 112   1                  {
 113   2                       temp=Data;
 114   2                       SCL=0;
 115   2                       _nop_();_nop_();_nop_();_nop_();_nop_();
 116   2                       if((temp&0x80)==0x80)
 117   2                          SDA=1;
C51 COMPILER V7.06   2402____Ò»_öÊý_Ý                                                      05/24/2010 11:21:06 PAGE 3   

 118   2                       else
 119   2                          SDA=0;
 120   2                              SCL=1;
 121   2                              temp=Data<<1;
 122   2                              Data=temp;
 123   2                              BitCounter--;
 124   2                        }
 125   1                while(BitCounter);
 126   1                    SCL=0;
 127   1                }
 128          
 129          
 130          /*------------------------------------------------
 131                         ¶Á³öÒ»¸ö×Ö½Ú²¢·µ»Ø
 132          ------------------------------------------------*/
 133          unsigned char Read_Byte(void)
 134                    {
 135   1                 unsigned char temp=0;
 136   1                 unsigned char temp1=0;
 137   1                 unsigned char BitCounter=8;
 138   1      
 139   1                 SDA=1;
 140   1                 do
 141   1                   {
 142   2                        SCL=0;
 143   2                _nop_();_nop_();_nop_();_nop_();_nop_();
 144   2                        SCL=1;
 145   2                        _nop_();_nop_();_nop_();_nop_();_nop_();
 146   2                        if(SDA)
 147   2                           temp=temp|0x01;
 148   2                        else
 149   2                           temp=temp&0xfe;
 150   2      
 151   2                        if(BitCounter-1)
 152   2                           {
 153   3                                temp1=temp<<1;
 154   3                                temp=temp1;
 155   3                                }
 156   2                                BitCounter--;
 157   2                               }
 158   1                      while(BitCounter);
 159   1                      return(temp);
 160   1                }
 161           
 162          /*------------------------------------------------
 163                              24c02Ð´ÈëÊý¾Ý
 164          Data[]:  ÐèÒª²Ù×÷µÄÊý×éÊ×µØÖ·
 165          Address: ´æ´¢µØÖ·
 166          Num:     Ð´ÈëÊý¾Ý¸öÊý
 167          ------------------------------------------------*/
 168          void Write_To_24C02(unsigned char Data[],unsigned char Address,unsigned char Num)
 169                    {
 170   1                 unsigned char i;
 171   1                 unsigned char *PData;
 172   1                 PData=Data;
 173   1                 for(i=0;i<Num;i++)
 174   1                    {
 175   2                         IIC_Start();
 176   2                         Send(AddWr);    //Ð´ÈëÐ¾Æ¬µØÖ·
*** WARNING C206 IN LINE 176 OF 2402´æ´¢Ò»¸öÊý¾Ý.C: 'Send': missing function-prototype
*** ERROR C267 IN LINE 176 OF 2402´æ´¢Ò»¸öÊý¾Ý.C: 'Send': requires ANSI-style prototype
 177   2                         Ack();
C51 COMPILER V7.06   2402____Ò»_öÊý_Ý                                                      05/24/2010 11:21:06 PAGE 4   

 178   2                         Send(Address+i);//Ð´Èë´æ´¢µØÖ·
 179   2                         Ack();
 180   2                         Send(*(PData+i));//Ð´Êý¾Ý
 181   2                         Ack();
 182   2                         IIC_Stop();
 183   2                         DelayMs(20);
 184   2                         }
 185   1                 }
 186          
 187          /*------------------------------------------------
 188                           24c02¶Á³öÊý¾Ý
 189          Data[]:  ÐèÒª²Ù×÷µÄÊý×éÊ×µØÖ·
 190          Address: ´æ´¢µØÖ·
 191          Num:     Ð´ÈëÊý¾Ý¸öÊý
 192          ------------------------------------------------*/
 193          void Read_From_24C02(unsigned char Data[],unsigned char Address,unsigned char Num)
 194                    {
 195   1                 unsigned char i;
 196   1                 unsigned char *PData;
 197   1                 PData=Data;
 198   1             for(i=0;i<Num;i++)
 199   1                    {
 200   2                         IIC_Start();        //Ð´ÈëÐ¾Æ¬µØÖ·
 201   2                         Send(AddWr);
 202   2                         Ack();
 203   2                         Send(Address+i);//Ð´Èë´æ´¢µØÖ·
 204   2                         Ack();
 205   2                         IIC_Start();
 206   2                         Send(AddRd);    //¶ÁÈëµØÖ·
 207   2                         Ack();
 208   2                         *(PData+i)=Read();//¶ÁÊý¾Ý
 209   2                         SCL=0;
 210   2                         No_Ack();
 211   2                         IIC_Stop();
 212   2                         }
 213   1                }
 214          
 215          /*------------------------------------------------
 216                             Ö÷³ÌÐò
 217          ------------------------------------------------*/
 218          void main()
 219                  {
 220   1               unsigned char Number[4]={0x06,0x5b,0x4f,0x66};// ÏÔÊ¾ÂëÖµ 1234
 221   1               unsigned char i;
 222   1               WP=0;                                         //Ð´±£»¤¹Øµô
 223   1               P2=0x00;
 224   1               
 225   1               Write_To_24C02(Number,4,4);                          //Ð´Èë24c02
 226   1               DelayMs(200);
 227   1               Number[0]=0;                                  //Çå³ýµ±Ç°Êý¾Ý
 228   1               Number[1]=0;
 229   1               Number[2]=0;
 230   1               Number[3]=0;
 231   1               Read_From_24C02(Number,4,4);                        //µ÷ÓÃ´æ´¢Êý¾Ý
 232   1               
 233   1               while(1)
 234   1                    { 
 235   2                 
 236   2                     P0=Number[i];                            //ÏÔÊ¾´æ´¢Êý¾Ý
 237   2                         DelayMs(200);                             //ÑÓÊ±ÓÃÓÚÑÝÊ¾ÏÔÊ¾Êý¾Ý
 238   2                         DelayMs(200);
 239   2                         i++;
C51 COMPILER V7.06   2402____Ò»_öÊý_Ý                                                      05/24/2010 11:21:06 PAGE 5   

 240   2                         if(i==4)
 241   2                            i=0;
 242   2                        }
 243   1              }
 244          
 245          

C51 COMPILATION COMPLETE.  1 WARNING(S),  1 ERROR(S)
