C51 COMPILER V7.06   MAIN                                                                  09/10/2012 09:02:04 PAGE 1   


C51 COMPILER V7.06, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Obj\main.obj
COMPILER INVOKED BY: d:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND PRINT(.\List\main.lst) OBJECT(.\Obj\main.o
                    -bj)

stmt level    source

   1          /*-----------------------------------------------
   2            名称：舵机控制        
   3            论坛：www.doflye.net
   4            编写：shifang
   5            日期：2009.5
   6            修改：无
   7            内容：通过按键调整舵机角度，舵机参数： 20ms周期，高电平时间从0.5ms~2.5ms,最大范围，根据不同舵机调整
   8          ------------------------------------------------*/
   9          #include<reg52.h>
  10          #include "delay.h"
  11          
  12          sbit OUT = P0^0;
  13          
  14          sbit KEY1=P3^0;  //定义按键输入端口
  15          sbit KEY2=P3^1;
  16          sbit KEY3=P3^2;
  17          sbit KEY4=P3^3;
  18          sbit KEY5=P3^4;
  19          sbit KEY6=P3^5;
  20          sbit KEY7=P3^6;
  21          sbit KEY8=P3^7;
  22          
  23          unsigned char TH_H,TL_H,TH_L,TL_L;//
  24          
  25          unsigned char KeyScan(void);
  26          /*------------------------------------------------
  27                              定时器初始化子程序
  28          ------------------------------------------------*/
  29          void Init_Timer0(void)
  30          {
  31   1       TMOD |= 0x01;    //使用模式1，16位定时器，使用"|"符号可以在使用多个定时器时不受影响    TOMD = TOMD | 0X01         
             -  
  32   1       TH0=0x00;            //给定初值，这里使用定时器最大值从0开始计数一直到65535溢出
  33   1       TL0=0x00;
  34   1       EA=1;            //总中断打开
  35   1       ET0=1;           //定时器中断打开
  36   1       TR0=1;           //定时器开关打开
  37   1      }
  38          /*------------------------------------------------
  39                           数据处理
  40          ------------------------------------------------*/
  41          void DataPro(unsigned int temp)
  42          {
  43   1               TH_H=(65536-temp)/256;
  44   1           TL_H=(65536-temp)%256;
  45   1               TH_L=(46536+temp)/256;
  46   1               TL_L=(46536+temp)%256;
  47   1      }
  48          /*------------------------------------------------
  49                           主程序
  50          ------------------------------------------------*/
  51          main()
  52          {
  53   1        unsigned char keynum;
C51 COMPILER V7.06   MAIN                                                                  09/10/2012 09:02:04 PAGE 2   

  54   1        unsigned int  temp=1500;
  55   1        Init_Timer0();
  56   1        DataPro(temp);
  57   1      
  58   1        while(1)
  59   1           {
  60   2                keynum=KeyScan();
  61   2                if(keynum==3)
  62   2                  {
  63   3                       if(temp<2300)
  64   3                         temp+=100;
  65   3               DataPro(temp);
  66   3                      }
  67   2                else if(keynum==4)
  68   2                 {
  69   3                   if(temp>600)
  70   3                         temp-=100;
  71   3                       DataPro(temp);
  72   3                 }
  73   2               }
  74   1      }
  75          
  76          /*------------------------------------------------
  77                           定时器中断子程序
  78          ------------------------------------------------*/
  79          void Timer0_isr(void) interrupt 1
  80          {
  81   1      if(OUT)
  82   1       {
  83   2       TH0=TH_L;                //重新赋值
  84   2       TL0=TL_L;
  85   2       }
  86   1      else
  87   1       {
  88   2        TH0=TH_H;               //重新赋值
  89   2        TL0=TL_H;
  90   2        }
  91   1      OUT=!OUT;
  92   1      }
  93          
  94          /*------------------------------------------------
  95                      按键扫描函数，返回扫描键值
  96          ------------------------------------------------*/
  97          unsigned char KeyScan(void)
  98          {
  99   1      /********************************************************/  
 100   1      if(!KEY1)  //如果检测到低电平，说明按键按下
 101   1          {
 102   2               DelayMs(10); //延时去抖，一般10-20ms
 103   2           if(!KEY1)     //再次确认按键是否按下，没有按下则退出
 104   2                 {
 105   3              while(!KEY1);//如果确认按下按键等待按键释放，没有则退出
 106   3                     {
 107   4                         return 1;
 108   4                              }
 109   3                 }
 110   2              }
 111   1      /********************************************************/  
 112   1      else if(!KEY2)  //如果检测到低电平，说明按键按下
 113   1          {
 114   2               DelayMs(10); //延时去抖，一般10-20ms
 115   2           if(!KEY2)     //再次确认按键是否按下，没有按下则退出
C51 COMPILER V7.06   MAIN                                                                  09/10/2012 09:02:04 PAGE 3   

 116   2                 {
 117   3              while(!KEY2);//如果确认按下按键等待按键释放，没有则退出
 118   3                     {
 119   4                         return 2;
 120   4                              }
 121   3                 }
 122   2              }
 123   1      /********************************************************/  
 124   1      else if(!KEY3)  //如果检测到低电平，说明按键按下
 125   1          {
 126   2               DelayMs(10); //延时去抖，一般10-20ms
 127   2           if(!KEY3)     //再次确认按键是否按下，没有按下则退出
 128   2                 {
 129   3              while(!KEY3);//如果确认按下按键等待按键释放，没有则退出
 130   3                     {
 131   4                         return 3;
 132   4                              }
 133   3                 }
 134   2              }
 135   1      /********************************************************/  
 136   1      else if(!KEY4)  //如果检测到低电平，说明按键按下
 137   1          {
 138   2               DelayMs(10); //延时去抖，一般10-20ms
 139   2           if(!KEY4)     //再次确认按键是否按下，没有按下则退出
 140   2                 {
 141   3              while(!KEY4);//如果确认按下按键等待按键释放，没有则退出
 142   3                     {
 143   4                         return 4;
 144   4                              }
 145   3                 }
 146   2              }
 147   1      /********************************************************/  
 148   1      else if(!KEY5)  //如果检测到低电平，说明按键按下
 149   1          {
 150   2               DelayMs(10); //延时去抖，一般10-20ms
 151   2           if(!KEY5)     //再次确认按键是否按下，没有按下则退出
 152   2                 {
 153   3              while(!KEY5);//如果确认按下按键等待按键释放，没有则退出
 154   3                     {
 155   4                         return 5;
 156   4                              }
 157   3                 }
 158   2              }
 159   1      /********************************************************/  
 160   1      else if(!KEY6)  //如果检测到低电平，说明按键按下
 161   1          {
 162   2               DelayMs(10); //延时去抖，一般10-20ms
 163   2           if(!KEY6)     //再次确认按键是否按下，没有按下则退出
 164   2                 {
 165   3              while(!KEY6);//如果确认按下按键等待按键释放，没有则退出
 166   3                     {
 167   4                         return 6;
 168   4                              }
 169   3                 }
 170   2              }
 171   1      /********************************************************/  
 172   1      else if(!KEY7)  //如果检测到低电平，说明按键按下
 173   1          {
 174   2               DelayMs(10); //延时去抖，一般10-20ms
 175   2           if(!KEY7)     //再次确认按键是否按下，没有按下则退出
 176   2                 {
 177   3              while(!KEY7);//如果确认按下按键等待按键释放，没有则退出
C51 COMPILER V7.06   MAIN                                                                  09/10/2012 09:02:04 PAGE 4   

 178   3                     {
 179   4                         return 7;
 180   4                              }
 181   3                 }
 182   2              }
 183   1      /********************************************************/  
 184   1      else if(!KEY8)  //如果检测到低电平，说明按键按下
 185   1          {
 186   2               DelayMs(10); //延时去抖，一般10-20ms
 187   2           if(!KEY8)     //再次确认按键是否按下，没有按下则退出
 188   2                 {
 189   3              while(!KEY8);//如果确认按下按键等待按键释放，没有则退出
 190   3                     {
 191   4                         return 8;
 192   4                              }
 193   3                 }
 194   2              }
 195   1      /********************************************************/  
 196   1      else
 197   1          return 0;
 198   1      }
 199          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    395    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4       5
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
